
apiVersion: v1
kind: Secret
metadata:
  name: awssm-secret
  namespace: fiap
type: Opaque
data:
  access-key: QVNJQVk0TUdCV0NTVzZKQ0wzWk8=
  secret-access-key: WlBxZm1VVHpPcURTSjdzbDk1bWJPOUUyYzI4dnF0MVJYbDdIUWpiVQ==
  session-token: SVFvSmIzSnBaMmx1WDJWakVHMGFDWFZ6TFhkbGMzUXRNaUpITUVVQ0lRQ0dJVHlwZ1dDclhmZTh0R3htM1Njenh6VUtIOGV2S2ZXWjNWbHY0SktIdndJZ0dKR3VaSEZrQk9HWnFpdktHd2xYb0NTZ0tUcTh1Q3VOY2FWZFJENGhmazRxd2dJSWx2Ly8vLy8vLy8vL0FSQUNHZ3cyTVRBM01ETXpOVFl3TmpraURIWDVtdUJsWXM0ZC9LWkIrU3FXQWxxb3c1a2dvSHorLzd0elZDdWhtV0FNYUNQdW8yMzFrcW9neGJvZjIzYW53TXBURndWc1BlQWhLcm4ybHhlK293NFNwUENINDkrOFRMMkxDaG5MVHVlM2xxa1g0QjBQWXlka2d1eFZoWGJOQUl0V3RHM0tVK0RrcXExdGw2cFNHVUx2TktTRkxLT1lIcVN1d1pBUjFtRE0wRHJkaE0xRnh1aTlFc0NDVDlDbHBNYU12U2NPd1pweEhHRVdJNGdMeU1SY1dGTkVwcE84bFJaNXNHQ2dBckFyKy8vaUpKQzcxSUlGSFdkYWtRaDl5c1Mxb1Q2S1ZmRzB6YlJpSlhaNVh3TEZzQ2hBNDgrQjRWYzdFNVlGbi9iYUxYVWJqaGpNczFCWHdUOGg4TXc4dXozYVJiWEIvbEIvOXNmc1BIY3RBT1VDSndUajZHVVZuWEFWZXlKUWdpd21lU2o5Zyt2eWZBbW5IbnVoa29zUE1xWHc2UldQTU95RGlMY0dPcDBCU1VGaVRmMjZXOGFuUmVPOUFLUGdpYlFRdFg5Q001RzBlS082V1NvL1NjSUU1Nm5FVmxkL3FXV2ZySlJDTGppb29VM0lqYThHTVJiSGs0NTFuVHBTc2JFOGJKdElhbm1uRDE4WithajJJb0hXVEwyZ1djaVhPcXkxN3NEUHNRMWJkUksxakZMZWRUdXBOaTVxd2Uwc1ExVkl1SEtFOWlqMUp1U0ZpbjBUc0FvWHlZc3pWSTlxbFlZcmxCVnZjOFFyU1pHWTdibDZrb290ZXhIOE9nPT0=

---
apiVersion: external-secrets.io/v1beta1
kind: ClusterSecretStore
metadata:
  name: restaurante-acme-secretstore
  namespace: fiap
spec:
  provider:
    aws:
      service: SecretsManager
      # define a specific role to limit access
      # to certain secrets.
      # role is a optional field that
      # can be omitted for test purposes
      region: us-east-1
      auth:
        secretRef:
          accessKeyIDSecretRef:
            name: awssm-secret
            key: access-key
            namespace: fiap
          secretAccessKeySecretRef:
            name: awssm-secret
            key: secret-access-key
            namespace: fiap
          sessionTokenSecretRef:
            name: awssm-secret
            key: session-token
            namespace: fiap

---
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: restaurante-acme-secrets
  namespace: fiap
spec:
  secretStoreRef:
    kind: ClusterSecretStore
    name: restaurante-acme-secretstore
  dataFrom:
    - extract:
        key: fiap/restaurante-acme-secrets
    - extract:
        key: fiap/restaurante-acme-database
  refreshInterval: 5m
  target:
    creationPolicy: Owner
    deletionPolicy: Retain

